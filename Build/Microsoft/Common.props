<?xml version="1.0" encoding="utf-8" ?>
<Project DefaultTargets="Build">
  <Target Name="DetermineOutputFileExtension">
    <PropertyGroup Condition="$(OutputType) == 'Library'">
      <OutputFileExtension>.dll</OutputFileExtension>
    </PropertyGroup>
    <PropertyGroup Condition="$(OutputType) == 'Exe' OR $(OutputType) == 'Winexe'">
      <OutputFileExtension>.exe</OutputFileExtension>
    </PropertyGroup>
  </Target>

  <Target Name="DetermineOutputPaths"
          DependsOnTargets="DetermineOutputFileExtension">
    <PropertyGroup>
      <OutputAssemblyName>$(AssemblyName)$(OutputFileExtension)</OutputAssemblyName>
      <OutputPdbName>$(AssemblyName).pdb</OutputPdbName>
      
      <IntermediatePath>bin\$(Configuration)</IntermediatePath>
      <IntermediateAssembly>$(IntermediatePath)\$(OutputAssemblyName)</IntermediateAssembly>
      <IntermediatePdb>$(IntermediatePath)\$(OutputPdbName)</IntermediatePdb>

      <OutputAssembly>$(OutputPath)\$(OutputAssemblyName)</OutputAssembly>
      <OutputPdb>$(OutputPath)\$(OutputPdbName)</OutputPdb>
    </PropertyGroup>
  </Target>

  <Target Name="ResolveReferences">
    
  </Target>
  
  <Target Name="CoreBuild"
          DependsOnTargets="DetermineOutputPaths;ResolveReferences">

    <!-- Prefer32Bit was introduced in .NET 4.5. Set it to false if we are targeting 4.0 -->
    <PropertyGroup Condition="'$(TargetFrameworkVersion)' == 'v4.0'">
      <Prefer32Bit>false</Prefer32Bit>
    </PropertyGroup>

    <Csc
      AllowUnsafeBlocks="$(AllowUnsafeBlocks)"
      Prefer32Bit="$(Prefer32Bit)"
      BaseAddress="$(BaseAddress)"
      CheckForOverflowUnderflow="$(CheckForOverflowUnderflow)"
      DebugType="$(DebugType)"
      DefineConstants="$(DefineConstants)"
      DelaySign="$(DelaySign)"
      DisabledWarnings="$(DisabledWarnings)"
      EmitDebugInformation="$(DebugSymbols)"
      ErrorEndLocation="$(ErrorEndLocation)"
      ErrorReport="$(ErrorReport)"
      FileAlignment="$(FileAlignment)"
      HighEntropyVA="$(HighEntropyVA)"
      MainEntryPoint="$(MainEntryPoint)"
      ModuleAssemblyName="$(ModuleAssemblyName)"
      NoConfig="true"
      NoLogo="$(NoLogo)"
      Optimize="$(Optimize)"
      OutputAssembly="$(IntermediateAssembly)"
      PdbFile="$(IntermediatePdb)"
      />
  </Target>

  <Target Name="CopyAppConfigFile"
          DependsOnTargets="CoreBuild"
          Condition="Exists('app.config')"
          Inputs="app.config"
          Output="$(OutputPath)\$(OutputFileName).config"
          >
    <Copy SourceFiles="app.config"
          DestinationFiles="$(OutputPath)\$(OutputAssemblyName).config" />
  </Target>

  <Target Name="CopyFilesToOutputDirectory"
          DependsOnTargets="CoreBuild">

    <Copy SourceFiles="$(IntermediateAssembly)" DestinationFiles="$(OutputAssembly)" />
    <Message Importance="Normal" Text="Build -> $(MSBuildProjectDirectory)\$(OutputFilePath)" />
    <Copy SourceFiles="$(IntermediatePdb)" DestinationFiles="$(OutputPdb)"
          Condition="Exists($(IntermediatePdb))" />
  </Target>

  <Target Name="Build"
          DependsOnTargets="CopyFilesToOutputDirectory;CopyAppConfigFile">
    <Message Importance="High" Text="Build Succeeded." />
  </Target>

</Project>